---
title: php反编译微信小程序浅析
date: 2019-01-30
categories: fun
tag: fun
---

### 此文由来
- 百度搜索 “反编译微信小程序” 能得到一大堆教程，github有一个是用php实现的反编译程序，以前没接触过此类开发，就clone下来分析了一下源码。
- 源码地址: [unpack-wxapkg](https://github.com/Clarence-pan/unpack-wxapkg)

### 原理概述
- 通过一些手段可以获取到小程序的源码包wxapkg文件，用编辑器sublime打开这个文件里面是一大堆16进制。通过php代码读取这个文件，根据一定的规则去把这个打包后的文件还原成项目目录和代码。
- wxapkg文件是明文存储的，所以为反编译提供了可能和便利。用在线16进制转字符串工具转换后可以看到部分文件信息。
- 一般的二进制文件里储存了大量的作用是offset和size的数据作为数据段的索引。最关键的所谓offset，就是目标数据在文件中的实际位置了，一般是ulong的数据，实际就是一个指针。一般读取文件时会先找到一个offset，然后file.seek(offset)到对应的位置然后接着读区。对于较为复杂的文件格式，offset飞来飞去非常频繁。同样，大部分储存了offset的地方也储存了size的，嘛用于校验数据避免指针越界嘛。因此，一旦我们可以确认一个文件中某一段数据段，就可以通过它的位置（offset）和大小（size）的实际数据进行搜索，逆向找到指向它的数据位置，并且继续逆向直到解析完整的文件。

### 预备知识

#### 字节序
- 字节序，简单来说，就是指的超过一个字节的数据类型在内存中存储的顺序

``` php
<?php
// 获取"静"的十六进制表示
echo bin2hex('静');

```